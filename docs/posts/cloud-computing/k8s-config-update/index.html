<!DOCTYPE html>
<html>
  <head>
    <title>Kubernetes ConfigMap çƒ­æ›´æ–°</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/assets/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/assets/css/layouts/main.css"/>
<link rel="stylesheet" href="/assets/css/style.css"/>
<link rel="stylesheet" href="/assets/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/assets/images/favicon.png" />


<link rel="stylesheet" href="/assets/css/style.css"/>

    
<meta name="description" content="Kubernetes ConfigMap çƒ­æ›´æ–°" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/assets/css/layouts/single.css"/>
<link rel="stylesheet" href="/assets/css/navigators/sidebar.css">


    
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-190574896-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    


  


  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/assets/images/main-logo.png">CctoctoFX</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/assets/images/main-logo.png" class="d-none" id="main-logo">
  <img src="/assets/images/inverted-logo.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="https://pillumina.github.io/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/do-not-wall/">(è½¬)åˆ«è®©è‡ªå·±å¢™äº†è‡ªå·±</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/how-to-learn/">(è½¬)å·¥ç¨‹å¸ˆåº”è¯¥å¦‚ä½•é«˜æ•ˆå­¦ä¹ </a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/programmer-career/">(è½¬)ç¨‹åºå‘˜å¦‚ä½•æŠŠæ§è‡ªå·±çš„èŒä¸š</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/black-magic/">Black Magic</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/iaas-paas-diff/">IaaS vs PaaS vs SaaS</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/links/">Tracking</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/golang/">Golang Odyssey</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/golang/channels/">Channels Concurrency</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/fasthttp/">fasthttpå¯¹æ€§èƒ½çš„ä¼˜åŒ–ç ”ç©¶</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/bdd-testing-framework/">Ginkgo æµ‹è¯•æ¡†æ¶</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/lifecycle-of-http/">Go serverä¸­httpè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/go-testing/">Golang Testing Kits</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/memory-management/">Golangå†…å­˜ç®¡ç†</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/schedualing/">Golangå¹¶å‘è°ƒåº¦</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/golang-escape-analysis/">Golangé€ƒé€¸åˆ†æ</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/goroutine-pool/">Goroutine Pool</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/websocket/">Million WebSocket</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/go-profiling/">Profling Go Service</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/sync-pool/">Sync Poolæºç åˆ†æ</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/channel-graceful/">ä¼˜é›…å…³é—­é€šé“</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/golang/memory-leak/">å¯èƒ½çš„å†…å­˜æ³„æ¼åœºæ™¯</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/java/">Java Odyssey</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/java/java-fundamentals/">Java Fundamentals</a></li>
  


      </ul>
    </li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/cloud-computing/">Kubernetes &amp; Docker</a>
      
      <ul class="active">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/docker-basic/">Docker Cheat Sheet</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/docker-aufs/">Docker Fundamentals (AUFS)</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/docker-cgroup/">Docker Fundamentals (Cgroup)</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/docker-namespace/">Docker Fundamentals (Namespace)</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/cloud-computing/k8s-config-update/">Kubernetes ConfigMap Hot Update</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/k8s-template/">Kubernetes Development</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/k8s-advance-schedule/">Kubernetes Handbook (Schedule)</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/k8s-basic/">Kubernetes Handbook (Start &amp; Pod)</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloud-computing/k8s-operator-dev/">Kubernetes Operator Development History</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/algo/">LC/CFåˆ·é¢˜ç¬”è®°</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/algo/string/">å­—ç¬¦ä¸²ä¸“é¢˜</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/open_courses/">Open Courses</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/open_courses/cmu-15210/">CMU 15210</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/open_courses/cmu-15451/">CMU 15451</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/design-pattern/">Programming Pattern</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/design-pattern/design-pattern/">Design Pattern Overview</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/design-pattern/go-pipeline/">Go Pipeline Pattern</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/design-pattern/go-visitor/">Go Visitor Pattern (k8s)</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/python/">Python Odyssey</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/python/python-functionality/">Pythonç±»è‡ªå®šä¹‰</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/rust/">Rust Odyssey</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/rust/basic/">Rusté˜…è¯»ç´¢å¼•é›†</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://pillumina.github.io/images/posts/k8s-docker.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/photo.jpeg'/>
          <h5 class="author-name"></h5>
          <p>April 24, 2021</p>
        </div>

        <div class="title">
          <h1>Kubernetes ConfigMap çƒ­æ›´æ–°</h1>
        </div>

        <div class="post-content" id="post-content">
          <p><em>æ³¨ï¼šå¦‚æœå¯¹kubernetesçš„åŸºæœ¬æ¦‚å¿µä¸å¤ªæ¸…æ¥šï¼Œå»ºè®®å…ˆè¿‡ä¸€ä¸‹åŸºæœ¬çš„èµ„æºç±»å‹å†é˜…è¯»æ­¤æ–‡</em></p>
<p>å…ˆéšä¾¿ç»™ä¸ªä¾‹å­:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">test-config</span>
<span style="color:#f92672">data</span>:
  <span style="color:#f92672">config.yml</span>: |-<span style="color:#e6db74">
</span><span style="color:#e6db74">    start-message: &#39;Hello, World!&#39;
</span><span style="color:#e6db74">    log-level: INFO</span>    
  <span style="color:#f92672">bootstrap.yml</span>:
    <span style="color:#f92672">listen-address</span>: <span style="color:#e6db74">&#39;127.0.0.1:8080&#39;</span>
</code></pre></div><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>ConfigMap</code>ï¼Œdataä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–‡ä»¶<code>config.yml</code>ä»¥åŠ<code>bootstrap.yml</code>ï¼Œå½“æˆ‘ä»¬è¦å¼•ç”¨å½“ä¸­çš„é…ç½®çš„æ—¶å€™ï¼Œ<code>kubernetes</code>æä¾›äº†ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨<code>configMapKeyRef</code>å¼•ç”¨<code>configMap</code>ä¸­æŸä¸ªæ–‡ä»¶çš„å†…å®¹ä½œä¸ºPodä¸­å®¹å™¨çš„ç¯å¢ƒå˜é‡ã€‚</p>
</li>
<li>
<p>æŠŠæ‰€æœ‰<code>configMap</code>ä¸­çš„æ–‡ä»¶å†™åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œå°†ä¸´æ—¶ç›®å½•ä½œä¸ºvolumeæŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä¹Ÿå°±æ˜¯<code>configmap</code>ç±»å‹çš„<code>volume</code>ã€‚</p>
<p>å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>Deployment</code>ï¼Œå®ƒçš„podæ¨¡æ¿é‡Œå¼•ç”¨äº†<code>configMap</code>ï¼Œç°åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š<strong>å½“<code>configmap</code>æ›´æ–°çš„æ—¶å€™ï¼Œè¿™ä¸ª<code>Deployment</code>çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿèƒ½éšä¹‹æ›´æ–°</strong>ã€‚é‚£ä¹ˆæœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</p>
</li>
<li>
<p>æœ€å¥½çš„æƒ…å†µæ˜¯ï¼Œå½“<code>configMap</code>å‘ç”Ÿå˜æ›´æ—¶ï¼Œç›´æ¥è¿›è¡Œhot updateï¼Œåšåˆ°ä¸å½±å“podçš„æ­£å¸¸è¿è¡Œã€‚</p>
</li>
<li>
<p>å¦‚æœæ— æ³•hot updateæˆ–è€…è¿™æ ·å®Œæˆä¸äº†éœ€æ±‚ï¼Œå°±è¦å‡ºå‘å¯¹åº”çš„<code>Deployment</code>åšä¸€æ¬¡æ»šåŠ¨æ›´æ–°ã€‚</p>
</li>
</ul>
<h2 id="åœºæ™¯ä¸€-é’ˆå¯¹å¯ä»¥è¿›è¡Œçƒ­æ›´æ–°çš„å®¹å™¨è¿›è¡Œé…ç½®çƒ­æ›´æ–°">åœºæ™¯ä¸€ï¼š é’ˆå¯¹å¯ä»¥è¿›è¡Œçƒ­æ›´æ–°çš„å®¹å™¨ï¼Œè¿›è¡Œé…ç½®çƒ­æ›´æ–°</h2>
<p>å¦‚æœ<code>configMap</code>ç”±volumeæŒ‚è½½ï¼Œæ¯”å¦‚ä¸‹è¿°çš„æŠ•å°„å·ï¼Œå®ƒçš„å†…å®¹æ˜¯å¯ä»¥æ›´æ–°çš„ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-test</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">container-test</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
    <span style="color:#f92672">volumeMounts</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">all-in-one</span>
      <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;/projected-volume&#34;</span>
      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">volumes</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">all-in-one</span>
    <span style="color:#f92672">projected</span>:
      <span style="color:#f92672">sources</span>:
      - <span style="color:#f92672">configMap</span>:
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myconfigmap</span>
          <span style="color:#f92672">items</span>:
            - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">config</span>
              <span style="color:#f92672">path</span>: <span style="color:#ae81ff">my-group/my-config</span>
</code></pre></div><p>ä¸ºäº†èƒ½å¤Ÿæ¯”è¾ƒå¥½å¾—ç†è§£ï¼Œå…ˆè¯´æ˜ä¸€ä¸‹<code>configMap</code>çš„volumeæŒ‚è½½æœºåˆ¶ï¼š</p>
<blockquote>
<p>æ›´æ–°æ“ä½œç”±kubeletçš„Pod Reconcileè§¦å‘ã€‚æ¯æ¬¡PodåŒæ­¥çš„æ—¶å€™ï¼ˆ10s defaultï¼‰ï¼Œkubeletéƒ½ä¼šæŠŠPodçš„æ‰€æœ‰<code>configMap</code>volumeæ ‡è®°ä¸º<code>RequireRemount</code>ï¼Œè€Œkubeletä¸­çš„volumeå¾ªç¯æ§åˆ¶ä¼šå‘ç°è¿™äº›éœ€è¦é‡æ–°æŒ‚è½½çš„volumeï¼Œå»æ‰§è¡Œä¸€æ¬¡æŒ‚è½½æ“ä½œã€‚</p>
</blockquote>
<p>åœ¨<code>configMap</code>çš„é‡æŒ‚è½½è¿‡ç¨‹ä¸­ï¼Œkubeletä¼šå…ˆæ¯”è¾ƒè¿œç«¯çš„<code>configMap</code>å’Œvolumeä¸­çš„<code>configMap</code>æ˜¯å¦ä¸€è‡´ï¼Œç„¶åå†åšæ›´æ–°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹¿åˆ°çš„è¿œç«¯<code>configMap</code>æ“ä½œå¯èƒ½æœ‰cacheï¼Œä¸ä¸€å®šæ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>æ‰€ä»¥è¿™æ ·çš„æ›´æ–°æ–¹å¼çš„ç¡®å¯è¡Œï¼Œä½†æ˜¯ä¼šæœ‰æ›´æ–°å»¶æ—¶ï¼Œæœ€å¤šçš„å»¶æ—¶æ—¶é—´ï¼š</p>
<p><strong>PodåŒæ­¥é—´éš”(é»˜è®¤10s) + ConfigMapæœ¬åœ°çš„ç¼“å­˜TTL</strong></p>
<blockquote>
<p>kubelet ä¸Š ConfigMap çš„è·å–æ˜¯å¦å¸¦ç¼“å­˜ç”±é…ç½®ä¸­çš„<code>ConfigMapAndSecretChangeDetectionStrategy</code> å†³å®šã€‚</p>
<p>æ³¨æ„ï¼Œå‡å¦‚ä½¿ç”¨äº† <code>subPath</code> å°† ConfigMap ä¸­çš„æŸä¸ªæ–‡ä»¶å•ç‹¬æŒ‚è½½åˆ°å…¶å®ƒç›®å½•ä¸‹ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶æ˜¯æ— æ³•çƒ­æ›´æ–°çš„ï¼ˆè¿™æ˜¯ ConfigMap çš„æŒ‚è½½é€»è¾‘å†³å®šçš„ï¼‰</p>
</blockquote>
<p>çŸ¥é“äº†åŸç†ï¼Œæˆ‘ä»¬å°±æ˜ç¡®ä¸€äº›æ¦‚å¿µï¼š</p>
<ol>
<li>å¦‚æœåº”ç”¨å¯¹<code>configMap</code>çš„æ›´æ–°æœ‰å®æ—¶æ€§è¦æ±‚ï¼Œå°±éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘é‡Œè‡ªå·±åˆ°<code>ApiServer</code>å»watchå¯¹åº”çš„<code>configMap</code>ï¼Œæˆ–è€…å¹²è„†ä¸ç”¨<code>configMap</code>è€Œç”¨<code>etcd</code>è¿™æ ·çš„ä¸€è‡´æ€§kvæ¥å­˜å‚¨ç®¡ç†é…ç½®ã€‚</li>
<li>åŠ å…¥æ²¡æœ‰å®æ—¶æ€§è¦æ±‚ï¼Œé‚£ä¹ˆ<code>configMap</code>æœ¬èº«çš„æ›´æ–°é€»è¾‘å°±å¯ä»¥åšåˆ°ã€‚</li>
</ol>
<p>ä¸è¿‡é…ç½®æ–‡ä»¶æ›´æ–°å®Œäº†å°±ä¸ä»£è¡¨ä¸šåŠ¡é€»è¾‘å°±æ›´æ–°äº†ï¼Œæˆ‘ä»¬è¿˜è¦è§£å†³å¦‚ä½•é€šçŸ¥åº”ç”¨é‡æ–°è¯»å–é…ç½®ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘ä¸Šçš„æ›´æ–°ã€‚ä¾‹å¦‚å¯¹äº<code>nginx</code>å°±éœ€è¦ä¸€ä¸ª<code>SIGHUP</code>ä¿¡å·é‡ï¼Œè¿™é‡Œå†è®¨è®ºå‡ ç§åšæ³•ã€‚</p>
<h3 id="çƒ­æ›´æ–°ä¸€-åº”ç”¨æœ¬èº«ç›‘å¬æœ¬åœ°é…ç½®æ–‡ä»¶">çƒ­æ›´æ–°ä¸€ï¼š åº”ç”¨æœ¬èº«ç›‘å¬æœ¬åœ°é…ç½®æ–‡ä»¶</h3>
<p>è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨åº”ç”¨é‡Œå†™ç›‘å¬çš„ä»£ç ã€‚ä¸€äº›é…ç½®ç›¸å…³çš„ä¸‰æ–¹ä»¶æœ¬èº«å°±åŒ…è£…äº†è¿™æ ·çš„é€»è¾‘ï¼Œæ¯”å¦‚<a href="https://github.com/spf13/viper">viper</a></p>
<h3 id="çƒ­æ›´æ–°äºŒä½¿ç”¨sidecarç›‘å¬æœ¬åœ°æ–‡ä»¶çš„å˜æ›´">çƒ­æ›´æ–°äºŒï¼šä½¿ç”¨sidecarç›‘å¬æœ¬åœ°æ–‡ä»¶çš„å˜æ›´</h3>
<p><code>Prometheus</code>çš„<code>Helm Chart</code>ä¸­ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œæ‰¾åˆ°ä¸€ä¸ªå®ç”¨çš„é•œåƒ<a href="https://github.com/jimmidyson/configmap-reload">configmap-reload</a>ï¼Œå®ƒå°±ä¼šå»watchæœ¬åœ°æ–‡ä»¶çš„å˜æ›´ï¼Œå¹¶åœ¨å‘ç”Ÿå˜æ›´æ—¶é€šè¿‡HTTPè°ƒç”¨é€šçŸ¥åº”ç”¨è¿›è¡Œçƒ­æ›´æ–°ã€‚</p>
<p>è¿™ç§æ–¹å¼å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼šsidecarå‘é€ä¿¡å·çš„é™åˆ¶æ¯”è¾ƒå¤šï¼Œè€Œå¾ˆå¤šå¼€æºç»„ä»¶æ¯”å¦‚<code>Fluentd</code>ï¼Œ<code>nginx</code>éƒ½æ˜¯ä¾èµ–<code>SIGHUP</code>ä¿¡å·è¿›è¡Œçƒ­æ›´æ–°çš„ã€‚åœ¨<code>kubernetes</code> 1.10ä¹‹å‰ï¼Œå¹¶ä¸æ”¯æŒpodä¸­çš„å®¹å™¨å…±äº«åŒä¸€ä¸ªpid namespaceï¼Œæ‰€ä»¥sidecarä¹Ÿå°±æ— æ³•å‘ä¸šåŠ¡å®¹å™¨å‘é€ä¿¡å·ã€‚åœ¨1.10ä»¥åï¼Œè™½ç„¶æ”¯æŒäº†pidå…±äº«ï¼Œä½†æ˜¯åœ¨å…±äº«ä¹‹åpid namespaceä¸­çš„1å·è¿›ç¨‹å°±ä¼šå˜æˆåŸºç¡€çš„<code>/pause</code>è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¾¿æ— æ³•è½»æ¾å®šä½åˆ°ç›®æ ‡è¿›ç¨‹äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œåªè¦k8sç‰ˆæœ¬åœ¨1.10ä»¥åï¼Œå¹¶ä¸”å¼€å¯äº†<code>ShareProcessNamespace</code>ç‰¹æ€§ï¼Œå¤šå†™ç‚¹ä»£ç ï¼Œæ¯”å¦‚é€šè¿‡è¿›ç¨‹åå»æ‰¾åˆ°pidï¼Œæ€»æ˜¯æœ‰åŠæ³•çš„ã€‚ä½†æ˜¯1.10ä¹‹å‰æ˜¯æ²¡å¯èƒ½çš„ã€‚</p>
<h3 id="çƒ­æ›´æ–°ä¸‰fat-container">çƒ­æ›´æ–°ä¸‰ï¼šFat Container</h3>
<p>èƒ–å®¹å™¨æ¯”è¾ƒ<code>åæ¨¡å¼</code>ï¼Œä¸è¿‡å¯ä»¥è§£å†³sidecarçš„ä¸€äº›é™åˆ¶ï¼ŒæŠŠä¸»è¿›ç¨‹å’Œsidecarè¿›ç¨‹æ‰“è¿›ä¸€ä¸ªé•œåƒé‡Œï¼Œè¿™æ ·å°±ç»•è¿‡äº†pid namespaceéš”ç¦»çš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæ¡ä»¶å…è®¸ï¼Œè¿˜æ˜¯ç”¨ä¸Šè¿°ä¸¤ä¸ªæ–¹æ¡ˆï¼Œå› ä¸ºå¤æ‚æ˜¯è„†å¼±çš„æ ¹æºï¼Œå®¹å™¨æœ¬èº«æ˜¯è½»é‡çš„ã€‚</p>
<h2 id="åœºæ™¯äºŒ-æ— æ³•çƒ­æ›´æ–°æ—¶æ»šåŠ¨æ›´æ–°pod">åœºæ™¯äºŒï¼š æ— æ³•çƒ­æ›´æ–°æ—¶ï¼Œæ»šåŠ¨æ›´æ–°Pod</h2>
<p>æ— æ³•çƒ­æ›´æ–°çš„åœºæ™¯ä¸¾ä¾‹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ol>
<li>åº”ç”¨æœ¬èº«æ²¡å†™çƒ­æ›´æ–°é€»è¾‘ï¼ˆå¤§éƒ¨åˆ†åº”ç”¨ä¸ä¼šå†™ï¼‰ã€‚</li>
<li>ä½¿ç”¨<code>subPath</code>è¿›ç¨‹<code>configMap</code>çš„æŒ‚è½½ï¼Œå¯¼è‡´<code>configMap</code>æ— æ³•è‡ªåŠ¨æ›´æ–°ã€‚</li>
<li>åœ¨ç¯å¢ƒå˜é‡æˆ–è€…<code>init-container</code>ä¸­ä¾èµ–äº†<code>configMap</code>çš„å†…å®¹ã€‚</li>
</ol>
<p>ç¬¬ä¸‰ç‚¹ï¼Œå°±æ˜¯ä½¿ç”¨<code>configMapKeyRef</code>å¼•ç”¨<code>configMap</code>ä¸­çš„ä¿¡æ¯ä½œä¸ºç¯å¢ƒå˜é‡æ—¶ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿåªä¼šåœ¨podåˆ›å»ºæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–°çš„ã€‚</p>
<p>å½“æ— æ³•è¿›è¡Œçƒ­æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æ»šåŠ¨å»æ›´æ–°Podäº†ã€‚ä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯å†™ä¸ªcontrollerå»watch<code>configMap</code>çš„å˜æ›´ï¼Œæœ‰å˜æ›´å°±ç»™<code>Deployment</code>èµ„æºåšæ»šåŠ¨æ›´æ–°ã€‚ä½†æ˜¯è¿™æ ·çš„å®ç°æ˜¯æ›´å¤æ‚çš„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è€ƒè™‘æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹å¼ã€‚</p>
<h3 id="æ»šåŠ¨æ›´æ–°ä¸€-ä¿®æ”¹ciæµç¨‹">æ»šåŠ¨æ›´æ–°ä¸€ï¼š ä¿®æ”¹CIæµç¨‹</h3>
<p>è¿™ä¸ªæ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦å†™ä¸€ä¸ªCIè„šæœ¬ï¼Œç»™<code>ConfigMap</code>è®¡ç®—ä¸€ä¸ªhashï¼Œç„¶åä½œä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡æˆ–è€…annotationåŠ å…¥åˆ°Deploymentçš„Podæ¨¡æ¿ä¸­ã€‚</p>
<p>ä¸¾ä¸ªğŸŒ°:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">...
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">annotations</span>:
        <span style="color:#f92672">com.cctoctofx.configmap/hash</span>: <span style="color:#ae81ff">${CONFIGMAP_HASH}</span>
...
</code></pre></div><p>è¿™æ ·ï¼Œå¦‚æœ<code>configMap</code>å˜åŒ–äº†ï¼Œé‚£ä¹ˆDeploymenté‡Œçš„Podæ¨¡æ¿è‡ªç„¶ä¼šå˜åŒ–ï¼Œk8sä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åšæ»šåŠ¨æ›´æ–°ã€‚ç”šè‡³å¦‚æœ<code>configMap</code>ä¸å¤æ‚ï¼Œç›´æ¥è½¬åŒ–ä¸ºjsonæ”¾åˆ°podæ¨¡æ¿é‡Œéƒ½è¡Œï¼Œè€Œä¸”è¿˜æ–¹ä¾¿æ•…éšœæ’æŸ¥çš„æ—¶å€™å¿«é€ŸçŸ¥é“å†…å®¹æ˜¯å•¥ã€‚</p>
<h3 id="æ»šåŠ¨æ›´æ–°äºŒcontroller">æ»šåŠ¨æ›´æ–°äºŒï¼šController</h3>
<p>å†™ä¸ªcontrolleræ£€æµ‹<code>configMap</code>å˜æ›´å¹¶è§¦å‘æ»šåŠ¨æ›´æ–°ï¼Œæ‰‹åŠ¨å†™ä¹‹å‰è¿˜æ˜¯çœ‹ä¸€çœ‹å¼€æºå®ç°ï¼š</p>
<ul>
<li><a href="https://github.com/stakater/Reloader">Reloader</a></li>
<li><a href="https://github.com/fabric8io/configmapcontroller">ConfigmapController</a></li>
<li><a href="https://github.com/mfojtik/k8s-trigger-controller">k8s-trigger-controller</a></li>
</ul>
<h3 id="æ»šåŠ¨æ›´æ–°ä¸‰liveness-probe--readiness-probe">æ»šåŠ¨æ›´æ–°ä¸‰ï¼šLiveness Probe / Readiness Probe</h3>
<p>è¿™ä¸ªæ‰‹æ®µéœ€è¦æ·±å…¥ä¸€ä¸‹ï¼Œåˆæ­¥æƒ³æ³•æ˜¯ç”¨livenessè°ƒç”¨ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å˜åŠ¨ï¼Œå¦‚æœå˜åŠ¨ï¼Œlivenesså¾—åˆ°falseï¼Œé‡å¯podï¼Œä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®readinessã€‚</p>
<h2 id="æ»šåŠ¨æ›´æ–°éœ€è¦è€ƒè™‘çš„é—®é¢˜">æ»šåŠ¨æ›´æ–°éœ€è¦è€ƒè™‘çš„é—®é¢˜</h2>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç”¨åœºæ™¯äºŒä¸­æåˆ°çš„æ–¹å¼å»æ›´æ–°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-deployment</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">annotations</span>:
      <span style="color:#f92672">nginx-config-md5</span>: <span style="color:#ae81ff">d41d8cd98f00b204e9800998ecf8427e</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx</span>
        <span style="color:#f92672">volumeMounts</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/etc/config</span>
      <span style="color:#f92672">volumes</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config-volume</span>
        <span style="color:#f92672">configMap</span>: 
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
---
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
<span style="color:#f92672">data</span>:
  <span style="color:#f92672">nginx.conf</span>: |-<span style="color:#e6db74">
</span><span style="color:#e6db74">    </span>    <span style="color:#75715e">## some configurations...</span>
</code></pre></div><blockquote>
<ul>
<li>æ¯æ¬¡éƒ¨ç½²çš„æ—¶å€™ï¼Œè®¡ç®—configMapçš„MD5,å¡«å…¥podçš„templateä¸­.</li>
<li>åŠ å…¥configMapå‘ç”Ÿå˜åŒ–ï¼Œæ‘˜è¦ä¹Ÿä¼šå˜åŒ–ï¼Œä¼šè§¦å‘ä¸€æ¬¡Deploymentçš„æ»šåŠ¨æ›´æ–°ã€‚</li>
</ul>
</blockquote>
<p>è¿™ä¸ªæµç¨‹çœ‹èµ·æ¥æ¯”è¾ƒç¾ï¼Œä½†æ€è€ƒä¸€ä¸‹å¦‚æœæˆ‘ä»¬æ›´æ–°äº†ä¸€ä¸ªé…ç½®ï¼Œä½†è¿™ä¸ªé…ç½®æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœpodä½¿ç”¨äº†é”™è¯¯çš„é…ç½®ä¼šæ— æ³•å·¥ä½œï¼ˆæ¯”å¦‚æ— æ³•é€šè¿‡<code>readinessProb</code>æ£€æŸ¥ï¼‰ã€‚æœ€åï¼Œæ»šåŠ¨æ›´æ–°çš„æµç¨‹å°±ä¼šå¡ä½ï¼Œé”™è¯¯çš„é…ç½®ä¸ä¼šæŠŠDeploymentæå´©æ‰ã€‚</p>
<p>è¿™ä¸ªé€»è¾‘çœ‹ç€ä¹ŸæŒºå¥½ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å´å¿½è§†äº†ï¼Œå¦‚æœ<code>nginx-config</code>æ›´æ–°æˆäº†é”™è¯¯çš„å€¼ï¼Œè™½ç„¶<strong>è¿˜æ²¡æœ‰é‡å»ºçš„Pod</strong>æš‚æ—¶æ˜¯å¥åº·çš„ï¼Œä½†æ˜¯å¦‚æœPodæŒ‚æ‰å‘ç”Ÿé‡å»ºï¼Œæˆ–è€…å…¶ä¸­çš„å®¹å™¨é‡æ–°è¯»å–äº†ä¸€æ¬¡é…ç½®ï¼Œé‚£ä¹ˆè¿™äº›Podå°±ä¼šé™·å…¥å¼‚å¸¸ã€‚æ‰€ä»¥æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€æ˜¯å¾ˆä¸ç¨³å®šçš„ã€‚</p>
<p>å› æ­¤é—®é¢˜çš„æœ¬è´¨æ˜¯ï¼š<strong>åœ¨åŸåœ°æ›´æ–°<code>configMap</code>æˆ–è€…<code>secret</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿›è¡Œæ»šåŠ¨å‘å¸ƒï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§æŠŠæ–°çš„é…ç½®æ›´æ–°åˆ°æ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰å®ä¾‹å½“ä¸­</strong>ã€‚è€Œæˆ‘ä»¬æ‰€è¯´çš„<code>æ»šåŠ¨æ›´æ–°</code>å°±æ˜¯æ§åˆ¶å„ä¸ªå®ä¾‹è¯»å–æ–°çš„é…ç½®çš„æ—¶æœºï¼Œå¯æ˜¯ç”±äºæˆ‘ä»¬æ— æ³•æŠŠæ§PodæŒ‚æ‰çš„æ—¶æœºï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®è¿›è¡Œè¿‡ç¨‹æ§åˆ¶ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<p>ä¸Šè¿°é—®é¢˜çš„é—®é¢˜åœ¨äº<strong>åŸåœ°æ›´æ–°</strong>ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦åœ¨æ¯æ¬¡<code>ConfigMap</code>å˜åŒ–çš„æ—¶å€™ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ª<code>ConfigMap</code>ï¼Œå†æ›´æ–°Deploymentä½¿ç”¨è¿™ä¸ªæ–°çš„<code>ConfigMap</code>å°±è¡Œäº†ã€‚è€Œé‡æ–°ç”Ÿæˆ<code>ConfigMap</code>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨å…¶å‘½åä¸­åŠ ä¸Š<code>ConfigMap</code>çš„dataå€¼è®¡ç®—å‡ºçš„æ‘˜è¦ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config-d41d8cd98f00b204e9800998ecf8427e</span>
<span style="color:#f92672">data</span>:
  <span style="color:#f92672">nginx.conf</span>: |-<span style="color:#e6db74">
</span><span style="color:#e6db74">    </span>    <span style="color:#75715e">## some configurations...</span>
</code></pre></div><p><code>ConfigMap</code>çš„Rolloutåœ¨ç¤¾åŒºä¸­ä¹Ÿæ˜¯å†ç»å¾ˆä¹…è¿˜æ²¡æœ‰è§£å†³(<a href="https://zhuanlan.zhihu.com/p/66051135/22368">#22368</a>)ï¼Œç›®å‰ä¸ºæ­¢ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å‘ä¹Ÿæ˜¯<code>immutable configmap</code>æ¨¡å¼ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<ul>
<li>å¦‚ä½•åšåˆ°æ¯æ¬¡é…ç½®æ–‡ä»¶æ›´æ–°æ—¶ï¼Œéƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ConfigMapï¼Ÿ</li>
<li>ç›®å‰ç¤¾åŒºçš„æ€åº¦æ˜¯æŠŠè¿™ä¸€æ­¥æ”¾åˆ°Clientè§£å†³ï¼Œæ¯”å¦‚helmå’Œkustomizeã€‚</li>
<li>å†å²configMapä¸æ–­ç§¯ç´¯ï¼Œèƒ½æ€ä¹ˆå›æ”¶ï¼Ÿ</li>
<li>é’ˆå¯¹è¿™ç‚¹ï¼Œç¤¾åŒºå¸Œæœ›åœ¨æœåŠ¡ç«¯å®ç°ä¸€ä¸ªGCæœºåˆ¶æ¥æ¸…ç†æ²¡æœ‰ä»»ä½•èµ„æºå¼•ç”¨çš„configMapã€‚</li>
</ul>
</blockquote>
<p>æŠŠæ›´æ–°é€»è¾‘æ”¾åœ¨clientç«¯è™½ç„¶ä¼šæœ‰é‡å¤é€ è½®å­çš„é—®é¢˜ï¼Œä½†æ˜¯è‡³å°‘ç›®å‰ä¸ºæ­¢ï¼ŒconfigMapçš„æ–°å»ºå’ŒDeploymentç­‰å¯¹è±¡çš„æ›´æ–°æ˜¯æœ€æˆç†Ÿçš„configMapæ»šåŠ¨æ›´æ–°æ–¹æ¡ˆã€‚</p>
<h3 id="kustomizeçš„å®è·µæ–¹å¼">Kustomizeçš„å®è·µæ–¹å¼</h3>
<p>Kustomizeå¯¹è¿™ä¸ªæ–¹æ¡ˆæœ‰å†…ç½®çš„æ”¯æŒï¼Œåªéœ€è¦ä½¿ç”¨<code>configGenerator</code>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">configMapGenerator</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-configmap</span>
  <span style="color:#f92672">files</span>:
  - <span style="color:#ae81ff">common.properties</span>
</code></pre></div><p>è¿™æ®µyamlå°±èƒ½åœ¨kustomizeä¸­ç”Ÿæˆä¸€ä¸ªconfigMapå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„dataæ¥è‡ªäº<code>common.properties</code>æ–‡ä»¶ï¼Œè€Œä¸”nameä¸­ä¼šåŠ ä¸Šè¿™ä¸ªæ–‡ä»¶çš„SHAå€¼ä½œä¸ºåç¼€ã€‚</p>
<p>åœ¨kustomizeçš„å…¶ä»–layerä¸­ï¼Œåªè¦ä»¥<code>my-configmap</code>ä½œä¸ºnameå¼•ç”¨è¿™ä¸ªconfigMapå³å¯ï¼Œå½“æœ€ç»ˆæ¸²æŸ“çš„æ—¶å€™ï¼Œkustomizeä¼šè‡ªåŠ¨è¿›è¡Œæ›¿æ¢æ“ä½œã€‚</p>
<h3 id="helmçš„å®è·µæ–¹å¼">Helmçš„å®è·µæ–¹å¼</h3>
<p>&hellip;</p>
<h2 id="é™„å½•">é™„å½•</h2>
<p><a href="https://github.com/kubernetes/kubernetes/issues/22368#issuecomment-421141188">facilitate ConfigMap rollouts/management discussion</a></p>

        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/pillumina/pillumina.Github.io/edit/master/content/posts/cloud-computing/k8s-config-update.md">
                <i class="fas fa-code-branch"></i>
                Improve This Page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/rust/basic/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Rusté˜…è¯»ç´¢å¼•</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/cloud-computing/k8s-template/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Kubernetes Developement</span>
          </a>
        </div>
      
    
  

  

  

</div>

      <hr />
      
      
          <div id="disqus_thread"></div>
<script type="text/javascript">
  (function () {
    
    
    if (window.location.hostname == "localhost") return;

    var dsq = document.createElement("script");
    dsq.type = "text/javascript";
    dsq.async = true;
    var disqus_shortname = "pillumina";
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
    (
      document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0]
    ).appendChild(dsq);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
<a href="https://disqus.com/" class="dsq-brlink"
  >comments powered by <span class="logo-disqus">Disqus</span></a
>

      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#åœºæ™¯ä¸€-é’ˆå¯¹å¯ä»¥è¿›è¡Œçƒ­æ›´æ–°çš„å®¹å™¨è¿›è¡Œé…ç½®çƒ­æ›´æ–°">åœºæ™¯ä¸€ï¼š é’ˆå¯¹å¯ä»¥è¿›è¡Œçƒ­æ›´æ–°çš„å®¹å™¨ï¼Œè¿›è¡Œé…ç½®çƒ­æ›´æ–°</a>
      <ul>
        <li><a href="#çƒ­æ›´æ–°ä¸€-åº”ç”¨æœ¬èº«ç›‘å¬æœ¬åœ°é…ç½®æ–‡ä»¶">çƒ­æ›´æ–°ä¸€ï¼š åº”ç”¨æœ¬èº«ç›‘å¬æœ¬åœ°é…ç½®æ–‡ä»¶</a></li>
        <li><a href="#çƒ­æ›´æ–°äºŒä½¿ç”¨sidecarç›‘å¬æœ¬åœ°æ–‡ä»¶çš„å˜æ›´">çƒ­æ›´æ–°äºŒï¼šä½¿ç”¨sidecarç›‘å¬æœ¬åœ°æ–‡ä»¶çš„å˜æ›´</a></li>
        <li><a href="#çƒ­æ›´æ–°ä¸‰fat-container">çƒ­æ›´æ–°ä¸‰ï¼šFat Container</a></li>
      </ul>
    </li>
    <li><a href="#åœºæ™¯äºŒ-æ— æ³•çƒ­æ›´æ–°æ—¶æ»šåŠ¨æ›´æ–°pod">åœºæ™¯äºŒï¼š æ— æ³•çƒ­æ›´æ–°æ—¶ï¼Œæ»šåŠ¨æ›´æ–°Pod</a>
      <ul>
        <li><a href="#æ»šåŠ¨æ›´æ–°ä¸€-ä¿®æ”¹ciæµç¨‹">æ»šåŠ¨æ›´æ–°ä¸€ï¼š ä¿®æ”¹CIæµç¨‹</a></li>
        <li><a href="#æ»šåŠ¨æ›´æ–°äºŒcontroller">æ»šåŠ¨æ›´æ–°äºŒï¼šController</a></li>
        <li><a href="#æ»šåŠ¨æ›´æ–°ä¸‰liveness-probe--readiness-probe">æ»šåŠ¨æ›´æ–°ä¸‰ï¼šLiveness Probe / Readiness Probe</a></li>
      </ul>
    </li>
    <li><a href="#æ»šåŠ¨æ›´æ–°éœ€è¦è€ƒè™‘çš„é—®é¢˜">æ»šåŠ¨æ›´æ–°éœ€è¦è€ƒè™‘çš„é—®é¢˜</a>
      <ul>
        <li><a href="#è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</a></li>
        <li><a href="#kustomizeçš„å®è·µæ–¹å¼">Kustomizeçš„å®è·µæ–¹å¼</a></li>
        <li><a href="#helmçš„å®è·µæ–¹å¼">Helmçš„å®è·µæ–¹å¼</a></li>
      </ul>
    </li>
    <li><a href="#é™„å½•">é™„å½•</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  


<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experiences</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>yxhuang@g.ucla.edu</span></li>
          
          <li><span>Phone: </span> <span>&#43;86-18657825298</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/assets/images/inverted-logo.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">Â© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/assets/images/hugo-logo-wide.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/assets/js/jquery-3.4.1.min.js"></script>
<script src="/assets/js/popper.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<script src="/assets/js/navbar.js"></script>
<script src="/assets/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/assets/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
